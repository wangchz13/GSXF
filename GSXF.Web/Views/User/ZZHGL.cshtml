
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>首页 - @ViewBag.Title</title>
    @Styles.Render("~/Content/easyui")
    @Scripts.Render("~/Content/easyuijs")

    <style>
        td{
            text-align:center;
        }
    </style>
    <script>

        $(function () {
            $('#userdg').datagrid({
                title: '账号列表',
                height: 'auto',
                rownumbers: true,
                collapsible: true,
                singleSelect: true,

                url: '/Data/getMyUsers',
                method: 'get',
                toolbar: '#tb'
            });

            $('#resetwin').window({
                title: '重置密码',
                modal: true,
                shadow: true,
                closed: true,
                footer:'#footer'
            });
        });

        function addbtn() {
            $.ajax({
                async:false,
                url: '/Data/CreateUser',
                success: function (data) {
                    if (data.Code == -1) {
                        $.messager.alert('提示', data.Message, 'info');
                        return;
                    }
                    $.messager.alert('提示', '账号生成成功！账号：' + data.Data.Name + '密码：' + data.Data.Password, 'info', function () {
                        $('#userdg').datagrid('reload');
                    });
                }
            });
        }

        function resetbtn() {
            var row = $('#userdg').datagrid('getSelected');
            if (row == null) {
                $.messager.alert('提示', '请先选中行', 'info');
                return;
            }
            $('#resetwin').window('open');
        }

        function reset() {


            if (!$('#resetform').form('validate')) {
                $.messager.alert('提示', '存在无效字段，请检查', 'info');
                return;
            }

            var row = $('#userdg').datagrid('getSelected');


            $.ajax({
                async: false,
                url: '/Data/resetPassword',
                dataType: 'json',
                type: 'POST',
                data: { "id": row.ID, "Password": $("#password").val() },
                success: function (data) {
                    $.messager.alert('提示', '密码重置成功！', 'info', function () {
                        $('#resetform').form('clear');
                        $('#resetwin').window('close');
                    });
                }
            });
        }

        
    </script>
</head>
<body style="padding:0;margin:0;">
        <div id="resetwin" style="padding:10px">
            <form id="resetform">


                <table>
                    <tr>
                        <td>
                            请输入新密码：
                        </td>
                        <td>
                            <input class="easyui-textbox" id="password" required="true" type="password" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            确认密码：
                        </td>
                        <td>
                            <input class="easyui-textbox easyui-validatebox" id="repassword" required="true" type="password" validType="equalTo['#password']" invalidMessage="两次输入密码不匹配" />
                        </td>
                    </tr>

                </table>
            </form>
            
            <br />
            
        </div>
        <div id="footer" style="padding:5px;text-align:center">
            <a class="easyui-linkbutton" onclick="reset()">确认</a>
        </div>


        <div id="tb" style="height:auto">
            <a href="#" class="easyui-linkbutton" plain="true" iconCls="icon-add"  onclick="addbtn()">添加新账号</a>|
            <a href="#" class="easyui-linkbutton" plain="true" iconCls="icon-reload" onclick="resetbtn()">重置密码</a>
        </div>
        <table id="userdg">
            <thead>
                <tr>
                    <th field="Name" width="300px">用户账号</th>
                    <th field="RegTime" width="80px">注册时间</th>
                    <th field="LoginTime" width="100px">上次登录时间</th>
                    <th field="LoginIP" width="100px">上次登录IP</th>
                    <th field="IsOnline" width="96px" data-options="formatter: function (value) {
                            if (value == true)
                                return '在线';
                            else
                                return '离线';
                        }">当前登录状态</th>
                </tr>
            </thead>
        </table>
        
</body>
</html>

@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>首页 - @ViewBag.Title</title>
    @Styles.Render("~/Content/easyui")
    @Scripts.Render("~/Content/easyuijs")
    <script>

        $(function () {
            $('#userdg').datagrid({
                title: '账号列表',
                height: 'auto',
                rownumbers: true,
                collapsible: true,
                singleSelect: true,

                url: '/Data/getMyUsers',
                method: 'get',
                toolbar: '#tb'
            });

            $('#resetwin').window({
                title: '重置密码',
                modal: true,
                shadow: true,
                closed: true
            });
        });

        function addbtn() {
            $('#addwin').window('open');
        }

        function resetbtn() {
            var row = $('#userdg').datagrid('getSelected');
            if (row == null) {
                $.messager.alert('提示', '请先选中行', 'info');
                return;
            }
            $('#resetwin').window('open');
        }

        function reset() {
            var row = $('#userdg').datagrid('getSelected');
            $.ajax({
                async: false,
                url: '/Data/resetPassword',
                dataType: 'json',
                type: 'POST',
                data: { "id": row.ID, "Password": $("#password").val() },
                success: function (data) {
                    $.messager.alert('提示', '密码重置成功', 'info', function () {
                        $('#win').window('close');
                    });
                }
            });
        }

        $.extend($.fn.validatebox.defaults.rules, {
            /*必须和某个字段相等*/
            equalTo: { validator: function (value, param) { return $(param[0]).val() == value; }, message: '字段不匹配' }
        });
    </script>
</head>
<body>
        <div id="resetwin" style="padding:10px">
            请输入新密码：

            <input class="easyui-textbox" id="password" required="true" type="password" />
            <br />
            确认密码：
            <input class="easyui-textbox easyui-validatebox" id="repassword" required="true" type="password" validType="equalTo['#password']" invalidMessage="两次输入密码不匹配"/>
        </div>


        <div id="tb" style="height:auto">
            <a href="#" class="easyui-linkbutton" plain="true" onclick="addbtn()">添加新账号</a>
            <a href="#" class="easyui-linkbutton" plain="true" onclick="resetbtn()">重置密码</a>
        </div>
        <table id="userdg">
            <thead>
                <tr>
                    <th field="Name" width="300px">用户账号</th>
                    <th field="RegTime" width="80px">注册时间</th>
                    <th field="LoginTime" width="100px">上次登录时间</th>
                    <th field="LoginIP" width="100px">上次登录IP</th>
                    <th field="IsOnline" width="96px">当前登录状态</th>
                </tr>
            </thead>
        </table>
        
</body>
</html>
@{
    Layout = null;
}

@Styles.Render("~/Content/easyui")
@Scripts.Render("~/Content/easyuijs")

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>首页 - @ViewBag.Title</title>
    <link href="~/Content/admin/admin.css" rel="stylesheet" />
    <script>
        $(function () {
            var tabs = $('#tabs').tabs({
                fit: true,
                border: false,
                tools: [{
                    iconCls: 'icon-house',
                    handler: function () {
                        tabs.tabs('select', 0);
                    }
                }, {
                    iconCls: 'icon-reload',
                    handler: function () {
                        var refresh_tab = $('#tabs').tabs('getSelected');
                        var refresh_iframe = refresh_tab.find('iframe')[0];
                        refresh_iframe.contentWindow.location.href = refresh_iframe.src;
                        //$("#tabs").trigger(TOPJUI.eventType.initUI.base);

                        //var index = tabs.tabs('getTabIndex', tabs.tabs('getSelected'));
                        //console.log(index);
                        //tabs.tabs('getTab', index).panel('refresh');
                    }
                }, {
                    iconCls: 'icon-no',
                    handler: function () {
                        var index = tabs.tabs('getTabIndex', tabs.tabs('getSelected'));
                        var tab = tabs.tabs('getTab', index);
                        if (tab.panel('options').closable) {
                            tabs.tabs('close', index);
                        }
                    }
                }]
            });

            $('#menu').tree({
                animate: true,
                onSelect: function (node) {
                    addTab(node.text, node.attributes.url);
                },
            });

            var node = $('#menu').tree('find', 'home');
            $('#menu').tree('select', node.target);

            var tab = $('#tabs').tabs('getSelected');
            $('#tabs').tabs('update', {
                tab: tab,
                options: {
                    closable: false  
                }
            });
        });

        function addTab(title, url) {

            if ($('#tabs').tabs('exists', title)) {
                $('#tabs').tabs('select', title);
            } else {
                var content = '<iframe scrolling="auto" frameborder="0"  src="' + url + '" style="width:100%;height:100%;"></iframe>';
                $('#tabs').tabs('add', {
                    title: title,
                    content: content,
                    closable: true
                });
            }
        }
        function logout() {
            $.messager.confirm('提示', '确定要退出吗?', function (r) {
                if (r) {
                    $.messager.progress({
                        text: '正在退出中...'
                    });
                    window.location.href = '/User/LoginOut';
                }
            });
        }
    </script>

    <style>
        #north, #south, #west {
            overflow: hidden;
        }

        #north {
            height: 100px;
        }

        #south {
            height: 40px;
        }

        #west {
            width: 200px;
        }
        .top-bg a{
            color:white;
            font-size:14px;
        }
    </style>
</head>
<body class="easyui-layout">
    <div id="north" region="north" split="true">
        <div class="top-bg">
            <span style="float:right; padding-right:10px;padding-top:64px;">
                <a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-user'" >
                    欢迎您， @ViewBag.User.Name
                </a>
                <a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-door_out'" onclick="logout()">
                    安全退出
                </a>
            </span>
        </div>
    </div>

    <div id="south" region="south" split="true">
        <div class="footer">版权所有:甘肃省消防总队</div>
    </div>

    <div id="west" region="west" split="true" title="菜单">
        <div class="easyui-accordion" style="position:absolute;top:27px;left:0px;right:0px;bottom:0px;">
            <ul id="menu" class="easyui-tree">
                @{ Html.RenderAction("Menu");}
            </ul>
        </div>
    </div>


    <div id="center" region="center" split="true">
        <div id="tabs" class="easyui-tabs" fit="true" border="false">

        </div>
    </div>
</body>
</html>

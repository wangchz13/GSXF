
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>首页 - @ViewBag.Title</title>
    @Styles.Render("~/Content/easyui")
    @Scripts.Render("~/Content/easyuijs")
    <script>

        $(function () {
            $('#userdg').datagrid({
                title: '用户列表',
                height: 'auto',
                rownumbers: true,
                collapsible: true,
                singleSelect: true,
                pagination: true,
                pageList: [10, 20, 30, 50, 100, 200],
                url: '/Data/getUsers',
                method: 'get',
                loadFilter: loadFilter
            });

            $('#win').window({
                title: '重置密码',
                modal: true,
                shadow: true,
                closed: true,
                footer:'#footer'
            });
        });
        function doSearch() {
            $('#userdg').datagrid('load', {
                Name: $('#nameid').val()
            });
        }

        function resetpassword() {
            var row = $('#userdg').datagrid('getSelected');
            if (row == null) {
                $.messager.alert('提示', '请先选中行', 'info');
                return;
            }
            $('#win').window('open');
        }

        function reset() {
            var row = $('#userdg').datagrid('getSelected');
            $.ajax({
                async: false,
                url: '/Data/resetPassword',
                dataType: 'json',
                type: 'POST',
                data: { "id": row.ID, "Password": $("#password").val() },
                success: function (data) {
                    $.messager.alert('提示', '密码重置成功', 'info', function () {
                        $('#win').window('close');
                    });
                }
            });
        }

    </script>
</head>
<body>
    <div>
        <div id="win">
            请输入新密码：
            
            <input class="easyui-textbox" id="password" required="true" />

        </div>
        <div id="footer" style="padding:5px;text-align:center;">
            <a href="#" class="easyui-linkbutton" iconCls="icon-save" onclick="reset()">确定</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-save" onclick="cancel()">取消</a>
        </div>



        <input id="nameid" style="line-height:26px;border:1px solid #ccc">
        <a href="#" class="easyui-linkbutton" plain="true" onclick="doSearch()">查找</a>
        <a href="#" class="easyui-linkbutton" plain="true" onclick="resetpassword()">重置密码</a>
        <table id="userdg" class="easyui-datagrid">
            <thead>
                <tr>
                    <th field="Name" width="300px">用户账号</th>
                    <th field="RegTime" width="80px">注册时间</th>
                    <th field="LoginTime" width="100px">上次登录时间</th>
                    <th field="LoginIP" width="100px">上次登录IP</th>
                    <th field="IsOnline" width="96px">当前状态</th>
                </tr>
            </thead>
        </table>
    </div>
</body>
</html>